import graph_tool as GT
import graph_tool.topology
# import xml.etree.ElementTree as ET
import lxml.etree as ET

number_of_nodes = 10
# Define my list of edges in advance
edge_list = [
      (1, 2, 'bus', True)
    , (1, 17, 'bus', True)
    , (1, 18, 'bus', True)
    , (2, 3, 'bus', True)
    , (2, 19, 'bus', True)
    , (2, 6, 'taxi', True)
    , (2, 17, 'taxi', True)
    , (2, 6, 'underground', True)
    , (2, 42, 'underground', True)
    , (3, 4, 'bus', True)
    , (4, 5, 'bus', True)
    , (5, 6, 'bus', True)
    , (5, 21, 'bus', True)
    , (6, 7, 'bus', True)
    , (6, 21, 'bus', True)
    , (6, 22, 'bus', True)
    , (6, 23, 'bus', True)
    , (6, 34, 'bus', True)
    , (6, 9, 'taxi', True)
    , (6, 31, 'taxi', True)
    , (6, 34, 'taxi', True)
    , (6, 61, 'underground', True)
    , (7, 8, 'bus', True)
    , (7, 23, 'bus', True)
    , (8, 9, 'bus', True)
    , (8, 23, 'bus', True)
    , (8, 24, 'bus', True)
    , (9, 10, 'bus', True)
    , (9, 25, 'bus', True)
    , (9, 12, 'taxi', True)
    , (9, 38, 'taxi', True)
    , (10, 11, 'bus', True)
    , (10, 26, 'bus', True)
    , (11, 12, 'bus', True)
    , (12, 13, 'bus', True)
    , (12, 26, 'bus', True)
    , (12, 28, 'bus', True)
    , (12, 15, 'taxi', True)
    , (13, 15, 'bus', True)
    , (13, 28, 'bus', True)
    , (14, 15, 'bus', True)
    , (14, 28, 'bus', True)
    , (14, 29, 'bus', True)
    , (15, 16, 'bus', True)
    , (15, 16, 'taxi', True)
    , (16, 29, 'bus', True)
    , (16, 54, 'bus', True)
    , (16, 29, 'taxi', True)
    , (16, 54, 'taxi', True)
    , (16, 29, 'underground', True)
    , (16, 54, 'underground', True)
    , (16, 50, 'boat', True)
    , (17, 30, 'bus', True)
    , (17, 31, 'taxi', True)
    , (17, 45, 'taxi', True)
    , (18, 19, 'bus', True)
    , (18, 30, 'bus', True)
    , (19, 20, 'bus', True)
    , (19, 31, 'bus', True)
    , (20, 21, 'bus', True)
    , (20, 31, 'bus', True)
    , (20, 32, 'bus', True)
    , (20, 43, 'bus', True)
    , (21, 22, 'bus', True)
    , (22, 33, 'bus', True)
    , (23, 36, 'bus', True)
    , (24, 25, 'bus', True)
    , (24, 36, 'bus', True)
    , (25, 26, 'bus', True)
    , (25, 37, 'bus', True)
    , (26, 27, 'bus', True)
    , (27, 28, 'bus', True)
    , (27, 38, 'bus', True)
    , (28, 29, 'bus', True)
    , (29, 53, 'bus', True)
    , (29, 38, 'taxi', True)
    , (29, 53, 'taxi', True)
    , (29, 38, 'underground', True)
    , (29, 112, 'underground', True)
    , (30, 31, 'bus', True)
    , (30, 39, 'bus', True)
    , (30, 40, 'bus', True)
    , (31, 41, 'bus', True)
    , (31, 42, 'bus', True)
    , (31, 42, 'taxi', True)
    , (31, 45, 'taxi', True)
    , (32, 33, 'bus', True)
    , (32, 44, 'bus', True)
    , (33, 34, 'bus', True)
    , (33, 44, 'bus', True)
    , (34, 35, 'bus', True)
    , (34, 44, 'bus', True)
    , (34, 48, 'bus', True)
    , (34, 42, 'taxi', True)
    , (34, 61, 'taxi', True)
    , (35, 36, 'bus', True)
    , (35, 37, 'bus', True)
    , (36, 37, 'bus', True)
    , (37, 49, 'bus', True)
    , (38, 49, 'bus', True)
    , (38, 50, 'bus', True)
    , (38, 53, 'taxi', True)
    , (38, 61, 'taxi', True)
    , (38, 80, 'taxi', True)
    , (38, 61, 'underground', True)
    , (38, 80, 'underground', True)
    , (39, 40, 'bus', True)
    , (39, 45, 'bus', True)
    , (40, 41, 'bus', True)
    , (40, 45, 'bus', True)
    , (40, 56, 'bus', True)
    , (41, 42, 'bus', True)
    , (41, 46, 'bus', True)
    , (41, 56, 'bus', True)
    , (42, 43, 'bus', True)
    , (42, 46, 'bus', True)
    , (42, 45, 'taxi', True)
    , (42, 74, 'taxi', True)
    , (42, 45, 'underground', True)
    , (43, 44, 'bus', True)
    , (43, 46, 'bus', True)
    , (44, 46, 'bus', True)
    , (44, 47, 'bus', True)
    , (45, 55, 'bus', True)
    , (45, 56, 'bus', True)
    , (45, 73, 'taxi', True)
    , (45, 74, 'underground', True)
    , (45, 114, 'underground', True)
    , (46, 58, 'bus', True)
    , (46, 59, 'bus', True)
    , (47, 48, 'bus', True)
    , (47, 59, 'bus', True)
    , (47, 60, 'bus', True)
    , (48, 61, 'bus', True)
    , (49, 61, 'bus', True)
    , (50, 51, 'bus', True)
    , (50, 62, 'bus', True)
    , (50, 63, 'bus', True)
    , (50, 79, 'boat', True)
    , (51, 52, 'bus', True)
    , (51, 63, 'bus', True)
    , (51, 64, 'bus', True)
    , (52, 53, 'bus', True)
    , (52, 65, 'bus', True)
    , (53, 54, 'bus', True)
    , (53, 65, 'bus', True)
    , (53, 67, 'bus', True)
    , (53, 54, 'taxi', True)
    , (53, 80, 'taxi', True)
    , (54, 68, 'bus', True)
    , (54, 70, 'bus', True)
    , (54, 91, 'taxi', True)
    , (54, 150, 'taxi', True)
    , (54, 112, 'underground', True)
    , (55, 71, 'bus', True)
    , (55, 72, 'bus', True)
    , (56, 57, 'bus', True)
    , (56, 72, 'bus', True)
    , (57, 58, 'bus', True)
    , (57, 73, 'bus', True)
    , (58, 59, 'bus', True)
    , (58, 74, 'bus', True)
    , (59, 76, 'bus', True)
    , (60, 61, 'bus', True)
    , (60, 76, 'bus', True)
    , (60, 77, 'bus', True)
    , (61, 79, 'bus', True)
    , (61, 75, 'taxi', True)
    , (61, 74, 'underground', True)
    , (61, 80, 'underground', True)
    , (62, 63, 'bus', True)
    , (62, 80, 'bus', True)
    , (63, 64, 'bus', True)
    , (63, 82, 'bus', True)
    , (64, 65, 'bus', True)
    , (64, 84, 'bus', True)
    , (64, 85, 'bus', True)
    , (65, 66, 'bus', True)
    , (65, 85, 'bus', True)
    , (66, 85, 'bus', True)
    , (66, 88, 'bus', True)
    , (67, 68, 'bus', True)
    , (67, 69, 'bus', True)
    , (68, 69, 'bus', True)
    , (69, 70, 'bus', True)
    , (69, 91, 'bus', True)
    , (70, 93, 'bus', True)
    , (71, 72, 'bus', True)
    , (71, 94, 'bus', True)
    , (72, 73, 'bus', True)
    , (73, 74, 'bus', True)
    , (73, 94, 'bus', True)
    , (73, 74, 'taxi', True)
    , (73, 114, 'taxi', True)
    , (74, 75, 'bus', True)
    , (74, 97, 'bus', True)
    , (74, 75, 'taxi', True)
    , (74, 99, 'underground', True)
    , (75, 76, 'bus', True)
    , (75, 98, 'bus', True)
    , (75, 100, 'bus', True)
    , (77, 79, 'bus', True)
    , (77, 100, 'bus', True)
    , (77, 102, 'bus', True)
    , (78, 79, 'bus', True)
    , (78, 102, 'bus', True)
    , (79, 80, 'bus', True)
    , (79, 80, 'taxi', True)
    , (79, 102, 'taxi', True)
    , (80, 81, 'bus', True)
    , (80, 103, 'bus', True)
    , (80, 108, 'bus', True)
    , (80, 104, 'taxi', True)
    , (80, 110, 'taxi', True)
    , (80, 110, 'underground', True)
    , (80, 161, 'boat', True)
    , (81, 82, 'bus', True)
    , (81, 108, 'bus', True)
    , (82, 83, 'bus', True)
    , (82, 84, 'bus', True)
    , (83, 86, 'bus', True)
    , (83, 108, 'bus', True)
    , (83, 110, 'bus', True)
    , (84, 85, 'bus', True)
    , (84, 86, 'bus', True)
    , (85, 86, 'bus', True)
    , (86, 87, 'bus', True)
    , (86, 88, 'bus', True)
    , (87, 88, 'bus', True)
    , (87, 90, 'bus', True)
    , (87, 111, 'bus', True)
    , (88, 89, 'bus', True)
    , (89, 90, 'bus', True)
    , (89, 91, 'bus', True)
    , (89, 110, 'taxi', True)
    , (89, 112, 'taxi', True)
    , (90, 112, 'bus', True)
    , (91, 92, 'bus', True)
    , (91, 93, 'bus', True)
    , (91, 112, 'taxi', True)
    , (92, 93, 'bus', True)
    , (92, 112, 'bus', True)
    , (92, 113, 'bus', True)
    , (94, 114, 'bus', True)
    , (95, 96, 'bus', True)
    , (95, 115, 'bus', True)
    , (96, 97, 'bus', True)
    , (96, 116, 'bus', True)
    , (96, 118, 'bus', True)
    , (97, 98, 'bus', True)
    , (97, 118, 'bus', True)
    , (98, 99, 'bus', True)
    , (99, 100, 'bus', True)
    , (99, 101, 'bus', True)
    , (99, 119, 'bus', True)
    , (99, 159, 'underground', True)
    , (100, 102, 'bus', True)
    , (101, 102, 'bus', True)
    , (101, 120, 'bus', True)
    , (102, 121, 'bus', True)
    , (102, 104, 'taxi', True)
    , (102, 119, 'taxi', True)
    , (103, 104, 'bus', True)
    , (103, 106, 'bus', True)
    , (104, 105, 'bus', True)
    , (104, 122, 'bus', True)
    , (104, 162, 'bus', True)
    , (105, 106, 'bus', True)
    , (105, 107, 'bus', True)
    , (105, 122, 'bus', True)
    , (106, 107, 'bus', True)
    , (106, 108, 'bus', True)
    , (107, 109, 'bus', True)
    , (107, 124, 'bus', True)
    , (108, 109, 'bus', True)
    , (108, 110, 'bus', True)
    , (109, 110, 'bus', True)
    , (109, 125, 'bus', True)
    , (110, 111, 'bus', True)
    , (110, 126, 'bus', True)
    , (110, 129, 'taxi', True)
    , (110, 144, 'taxi', True)
    , (110, 112, 'underground', True)
    , (110, 144, 'underground', True)
    , (111, 112, 'bus', True)
    , (111, 128, 'bus', True)
    , (112, 113, 'bus', True)
    , (112, 131, 'bus', True)
    , (112, 129, 'taxi', True)
    , (112, 170, 'underground', True)
    , (113, 132, 'bus', True)
    , (114, 115, 'bus', True)
    , (114, 135, 'bus', True)
    , (114, 117, 'taxi', True)
    , (114, 175, 'underground', True)
    , (115, 116, 'bus', True)
    , (116, 117, 'bus', True)
    , (116, 135, 'bus', True)
    , (117, 118, 'bus', True)
    , (117, 136, 'bus', True)
    , (117, 155, 'bus', True)
    , (117, 119, 'taxi', True)
    , (117, 172, 'taxi', True)
    , (118, 119, 'bus', True)
    , (118, 137, 'bus', True)
    , (119, 120, 'bus', True)
    , (119, 137, 'bus', True)
    , (119, 138, 'bus', True)
    , (119, 159, 'taxi', True)
    , (120, 121, 'bus', True)
    , (121, 140, 'bus', True)
    , (122, 141, 'bus', True)
    , (123, 124, 'bus', True)
    , (123, 141, 'bus', True)
    , (124, 125, 'bus', True)
    , (124, 142, 'bus', True)
    , (124, 144, 'taxi', True)
    , (124, 162, 'taxi', True)
    , (125, 126, 'bus', True)
    , (125, 144, 'bus', True)
    , (126, 127, 'bus', True)
    , (126, 145, 'bus', True)
    , (127, 128, 'bus', True)
    , (127, 129, 'bus', True)
    , (128, 131, 'bus', True)
    , (129, 130, 'bus', True)
    , (129, 145, 'bus', True)
    , (129, 147, 'bus', True)
    , (129, 144, 'taxi', True)
    , (129, 146, 'taxi', True)
    , (130, 131, 'bus', True)
    , (130, 148, 'bus', True)
    , (131, 132, 'bus', True)
    , (131, 133, 'bus', True)
    , (132, 133, 'bus', True)
    , (132, 134, 'bus', True)
    , (133, 148, 'bus', True)
    , (133, 149, 'bus', True)
    , (134, 150, 'bus', True)
    , (135, 154, 'bus', True)
    , (135, 171, 'bus', True)
    , (136, 137, 'bus', True)
    , (136, 156, 'bus', True)
    , (136, 157, 'bus', True)
    , (136, 158, 'bus', True)
    , (137, 138, 'bus', True)
    , (137, 158, 'bus', True)
    , (138, 139, 'bus', True)
    , (138, 159, 'bus', True)
    , (139, 140, 'bus', True)
    , (139, 161, 'bus', True)
    , (140, 161, 'bus', True)
    , (141, 142, 'bus', True)
    , (142, 162, 'bus', True)
    , (142, 163, 'bus', True)
    , (143, 144, 'bus', True)
    , (143, 163, 'bus', True)
    , (143, 164, 'bus', True)
    , (144, 145, 'bus', True)
    , (144, 165, 'bus', True)
    , (144, 194, 'taxi', True)
    , (144, 162, 'underground', True)
    , (144, 196, 'underground', True)
    , (145, 146, 'bus', True)
    , (146, 147, 'bus', True)
    , (146, 166, 'bus', True)
    , (146, 167, 'bus', True)
    , (146, 168, 'bus', True)
    , (146, 194, 'taxi', True)
    , (147, 148, 'bus', True)
    , (147, 151, 'bus', True)
    , (148, 149, 'bus', True)
    , (149, 151, 'bus', True)
    , (149, 152, 'bus', True)
    , (150, 152, 'bus', True)
    , (150, 170, 'taxi', True)
    , (151, 153, 'bus', True)
    , (152, 153, 'bus', True)
    , (152, 170, 'bus', True)
    , (153, 168, 'bus', True)
    , (153, 170, 'bus', True)
    , (154, 171, 'bus', True)
    , (155, 156, 'bus', True)
    , (156, 157, 'bus', True)
    , (156, 172, 'bus', True)
    , (157, 172, 'bus', True)
    , (157, 173, 'bus', True)
    , (157, 177, 'bus', True)
    , (158, 159, 'bus', True)
    , (158, 177, 'bus', True)
    , (159, 160, 'bus', True)
    , (159, 180, 'bus', True)
    , (159, 161, 'taxi', True)
    , (159, 177, 'taxi', True)
    , (159, 162, 'underground', True)
    , (159, 175, 'underground', True)
    , (160, 161, 'bus', True)
    , (160, 181, 'bus', True)
    , (161, 162, 'bus', True)
    , (161, 181, 'bus', True)
    , (161, 162, 'taxi', True)
    , (161, 187, 'boat', True)
    , (162, 163, 'bus', True)
    , (162, 185, 'bus', True)
    , (162, 186, 'bus', True)
    , (162, 187, 'taxi', True)
    , (162, 196, 'underground', True)
    , (163, 186, 'bus', True)
    , (163, 190, 'bus', True)
    , (164, 165, 'bus', True)
    , (164, 190, 'bus', True)
    , (164, 192, 'bus', True)
    , (165, 166, 'bus', True)
    , (165, 192, 'bus', True)
    , (165, 194, 'bus', True)
    , (166, 167, 'bus', True)
    , (166, 194, 'bus', True)
    , (167, 168, 'bus', True)
    , (167, 197, 'bus', True)
    , (168, 169, 'bus', True)
    , (168, 199, 'bus', True)
    , (168, 170, 'taxi', True)
    , (168, 198, 'taxi', True)
    , (169, 170, 'bus', True)
    , (169, 200, 'bus', True)
    , (169, 201, 'bus', True)
    , (170, 201, 'bus', True)
    , (170, 202, 'taxi', True)
    , (170, 196, 'underground', True)
    , (171, 172, 'bus', True)
    , (171, 174, 'bus', True)
    , (172, 173, 'bus', True)
    , (172, 177, 'taxi', True)
    , (173, 175, 'bus', True)
    , (173, 176, 'bus', True)
    , (174, 175, 'bus', True)
    , (175, 176, 'bus', True)
    , (176, 177, 'bus', True)
    , (177, 178, 'bus', True)
    , (177, 179, 'bus', True)
    , (178, 183, 'bus', True)
    , (179, 180, 'bus', True)
    , (179, 182, 'bus', True)
    , (179, 183, 'bus', True)
    , (180, 181, 'bus', True)
    , (180, 182, 'bus', True)
    , (181, 182, 'bus', True)
    , (182, 184, 'bus', True)
    , (183, 184, 'bus', True)
    , (185, 186, 'bus', True)
    , (185, 187, 'bus', True)
    , (185, 188, 'bus', True)
    , (186, 188, 'bus', True)
    , (187, 189, 'bus', True)
    , (187, 196, 'taxi', True)
    , (188, 189, 'bus', True)
    , (188, 190, 'bus', True)
    , (189, 191, 'bus', True)
    , (190, 191, 'bus', True)
    , (191, 192, 'bus', True)
    , (191, 193, 'bus', True)
    , (192, 194, 'bus', True)
    , (193, 194, 'bus', True)
    , (193, 196, 'bus', True)
    , (194, 195, 'bus', True)
    , (194, 196, 'taxi', True)
    , (195, 196, 'bus', True)
    , (195, 197, 'bus', True)
    , (196, 197, 'bus', True)
    , (196, 198, 'taxi', True)
    , (197, 198, 'bus', True)
    , (198, 199, 'bus', True)
    , (198, 200, 'bus', True)
    , (198, 202, 'taxi', True)
    , (200, 201, 'bus', True)
    , (200, 202, 'bus', True)
    , (201, 202, 'bus', True)
]

g = GT.Graph(directed=False)
g.add_vertex(number_of_nodes)
ep_transportation = g.new_ep("string")
ep_public = g.new_ep("bool")
g.add_edge_list(edge_list, eprops=[ep_transportation, ep_public])

xml_board_root = ET.Element('boardPositions')
xml_hiders_root = ET.Element('distances')
xml_seekers_root = ET.Element('distances')

# To produce the Seekers distance map we filter by only public edges
g.set_edge_filter(ep_public)
sd_seekers = graph_tool.topology.shortest_distance(g)
# To produce the Hiders distance map we remove the filter to include all edges
g.set_edge_filter(None)
sd_hiders = graph_tool.topology.shortest_distance(g)

for s in g.vertices():
    if not s.out_degree():
        continue  # Skip unused nodes (typically 0)
    boardPosition = ET.SubElement(xml_board_root, 'boardPosition', {'id': str(s)})

    for e in s.all_edges():
        assert(e.source() == s)
        action = ET.SubElement(boardPosition, 'action')
        ET.SubElement(action, 'destination').text = str(e.target())
        ET.SubElement(action, 'transportation').text = ep_transportation[e]

    from_seekers = None  # We will initialize these later, when needed.
    from_hiders = None

    for t in g.vertices(): # TODO: we can speed this up by not iterating through all vertices if we know that we should start at s anyway
        if (t > s):
            dist_seekers = sd_seekers[s][t]
            dist_hiders = sd_hiders[s][t]

            if dist_seekers <= number_of_nodes:
                if from_seekers is None:
                    from_seekers = ET.SubElement(xml_seekers_root, 'from', {'id': str(s)})
                to_seekers = ET.SubElement(from_seekers, 'to', {'id': str(t)})
                ET.SubElement(to_seekers, 'distance').text = str(dist_seekers)

            if dist_hiders <= number_of_nodes:
                if from_hiders is None:
                    from_hiders = ET.SubElement(
                        xml_hiders_root, 'from', {'id': str(s)})
                to_hiders = ET.SubElement(from_hiders, 'to', {'id': str(t)})
                ET.SubElement(to_hiders, 'distance').text = str(dist_hiders)

xml_board = ET.ElementTree(xml_board_root)
xml_board.write('board_file.xml', encoding='UTF-8',
                xml_declaration=True, pretty_print=True)

xml_seekers = ET.ElementTree(xml_seekers_root)
xml_seekers.write('seekers_distances_file.xml', encoding='UTF-8',
                  xml_declaration=True, pretty_print=True)

xml_hiders = ET.ElementTree(xml_hiders_root)
xml_hiders.write('hiders_distances_file.xml', encoding='UTF-8',
                 xml_declaration=True, pretty_print=True)
